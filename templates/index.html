<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Master Sikku Kolam Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<style>
body { text-align: center; font-family: Arial; }
canvas { border: 1px solid #aaa; margin-top: 10px; }
.controls { margin: 15px; }
</style>
</head>
<body>
<h2>Master Sikku Kolam Generator</h2>
<div class="controls">
  Pattern:
  <select id="pattern">
    <option value="classic">Classic Square</option>
    <option value="flower">Flower / Radial Grid</option>
    <option value="diamond">Diamond</option>
    <option value="radialcircle">Radial Full Circle</option>
  </select>
  Arc Type:
  <select id="arctype">
    <option value="quarter">Quarter / Half Loops</option>
    <option value="full">Full Circle</option>
  </select>
  Rows: <input type="number" id="rows" value="5" min="2">
  Cols: <input type="number" id="cols" value="5" min="2">
  <label><input type="checkbox" id="skipAnim"> Skip Animation</label>
  <button onclick="generateKolam()">Generate Kolam</button>
  <button onclick="restartAnimation()">Replay</button>
</div>

<script>
let spacing = 60;
let dots = [];
let path = [];
let t = 0;
let rows = 5, cols = 5;

function setup() {
  createCanvas(600, 600);
  stroke(0, 100, 200);
  strokeWeight(2);
  noFill();
  generateKolam();
}

function draw() {
  background(255);

  let skipAnimation = document.getElementById("skipAnim").checked;

  // Draw dots
  fill(0);
  noStroke();
  for (let d of dots) circle(d.x, d.y, 6);

  // Draw arcs/circles
  noFill();
  stroke(0, 100, 200);
  strokeWeight(2);

  if (skipAnimation) {
    // Draw all at once
    for (let p of path) drawArcOrCircle(p);
  } else {
    // Animate
    for (let i = 0; i < int(t) && i < path.length; i++) drawArcOrCircle(path[i]);
    if (t < path.length) t += 0.05;
  }
}

function drawArcOrCircle(p) {
  if (p.full) ellipse(p.x, p.y, spacing, spacing);
  else arc(p.x, p.y, spacing, spacing, p.start, p.end);
}

function generateKolam() {
  dots = [];
  path = [];
  t = 0;

  let pattern = document.getElementById("pattern").value;
  let arctype = document.getElementById("arctype").value;
  rows = int(document.getElementById("rows").value);
  cols = int(document.getElementById("cols").value);

  if (pattern === "classic" || pattern === "flower") {
    generateGridPattern(pattern);
    generatePathClassic(arctype);
  } else if (pattern === "diamond") {
    generateDiamondPattern();
    generatePathDiamond(arctype);
  } else if (pattern === "radialcircle") {
    generateRadialPattern(arctype);
  }
}

function generateGridPattern(pattern) {
  let offsetX = width/2 - (cols-1)*spacing/2;
  let offsetY = height/2 - (rows-1)*spacing/2;

  if (pattern === "classic") {
    for (let r=0; r<rows; r++)
      for (let c=0; c<cols; c++)
        dots.push({x: offsetX+c*spacing, y: offsetY+r*spacing, row:r, col:c});
  } else if (pattern === "flower") {
    let centerX = width/2;
    let centerY = height/2;
    let layers = Math.min(rows, cols);
    for (let r=0; r<layers; r++)
      for (let c=0; c<layers; c++)
        if ((r+c)%2===0) {
          let x = centerX + (c-layers/2)*spacing;
          let y = centerY + (r-layers/2)*spacing;
          dots.push({x:x, y:y, row:r, col:c});
        }
  }
}

function generatePathClassic(arctype) {
  for (let r=0; r<rows; r++) {
    let leftToRight = r%2===0;
    for (let c = leftToRight?0:cols-1; leftToRight?c<cols:c>=0; leftToRight?c++:c--) {
      let dot = dots[r*cols+c]||dots[0];
      if (arctype==="full") path.push({x:dot.x, y:dot.y, full:true});
      else {
        if ((r+c)%2===0) {
          path.push({x:dot.x, y:dot.y, start:0, end:HALF_PI});
          path.push({x:dot.x, y:dot.y, start:PI, end:PI+HALF_PI});
        } else {
          path.push({x:dot.x, y:dot.y, start:HALF_PI, end:PI});
          path.push({x:dot.x, y:dot.y, start:PI+HALF_PI, end:TWO_PI});
        }
      }
    }
  }
}

function generateDiamondPattern() {
  let centerX = width/2;
  let centerY = height/2;
  dots = [];
  for (let r=-rows+1; r<rows; r++)
    for (let c=-cols+1; c<cols; c++)
      if (Math.abs(r+c)%2===0) {
        let x = centerX + c*spacing;
        let y = centerY + r*spacing;
        dots.push({x:x, y:y, row:r, col:c});
      }
}

function generatePathDiamond(arctype) {
  let sortedDots = dots.slice().sort((a,b)=>a.y-b.y || a.x-b.x);
  let currentY = null;
  let rowDots = [];
  
  for (let dot of sortedDots) {
    if (currentY===null || Math.abs(dot.y-currentY)<1) rowDots.push(dot), currentY=dot.y;
    else { addRowToPath(rowDots, arctype); rowDots=[dot]; currentY=dot.y; }
  }
  if (rowDots.length>0) addRowToPath(rowDots, arctype);
}

function addRowToPath(rowDots, arctype) {
  let leftToRight=true;
  for (let i=0;i<rowDots.length;i++) {
    let idx = leftToRight?i:rowDots.length-1-i;
    let dot = rowDots[idx];
    if (arctype==="full") path.push({x:dot.x, y:dot.y, full:true});
    else {
      if (i%2===0) { path.push({x:dot.x, y:dot.y, start:0, end:HALF_PI}); path.push({x:dot.x, y:dot.y, start:PI, end:PI+HALF_PI}); }
      else { path.push({x:dot.x, y:dot.y, start:HALF_PI, end:PI}); path.push({x:dot.x, y:dot.y, start:PI+HALF_PI, end:TWO_PI}); }
    }
  }
}

function generateRadialPattern(arctype) {
  let centerX = width/2;
  let centerY = height/2;
  let layers = Math.min(rows, cols);

  for (let r=0; r<layers; r++) {
    let numDots = r*6 + 6;
    let radius = spacing*(r+1);
    for (let i=0;i<numDots;i++) {
      let angle = TWO_PI*i/numDots;
      let x = centerX + radius*cos(angle);
      let y = centerY + radius*sin(angle);
      dots.push({x:x, y:y, row:r, col:i});
      if (arctype==="full") path.push({x:x, y:y, full:true});
      else path.push({x:x, y:y, start:0, end:HALF_PI});
    }
  }
}

function restartAnimation() { t=0; }
</script>
</body>
</html>